# $Id: Jamfile,v 1.34 2005/10/15 18:05:03 titer Exp $
#
# This file is part of the HandBrake source code.
# Homepage: <http://handbrake.fr/>.
# It may be used under the terms of the GNU General Public License.

SubDir TOP libhb : hbversion.h ;

LIBHB_SRC =
common.c hb.c ports.c scan.c work.c decmpeg2.c encavcodec.c update.c
demuxmpeg.c fifo.c render.c reader.c muxcommon.c muxmp4.c sync.c stream.c
decsub.c deca52.c decdca.c encfaac.c declpcm.c encx264.c decavcodec.c encxvid.c
muxavi.c enclame.c muxogm.c encvorbis.c dvd.c muxmkv.c deblock.c deinterlace.c 
denoise.c detelecine.c decomb.c lang.c enctheora.c ;

Library libhb : $(LIBHB_SRC) ;

ObjectCcFlags $(LIBHB_SRC) : -I$(TOP)/contrib/include ;
ObjectDefines $(LIBHB_SRC) : __LIBHB__ ;
ObjectC++Flags $(LIBHB_SRC) : -I$(TOP)/contrib/include ;

# turn the version number, etc., into an include file for cretinous build
# systems (XCode) that can't run shell commands
rule HBVersion
{
    Clean clean : $(TOP)/libhb/$(1) ;
}
actions HBVersion
{
    echo "#ifndef HB_BUILD" > $(TOP)/libhb/$(1)
    echo "#define HB_BUILD $(HB_BUILD)" >> $(TOP)/libhb/$(1)
    echo "#endif" >> $(TOP)/libhb/$(1)
    echo "#ifndef HB_VERSION" >> $(TOP)/libhb/$(1)
    echo "#define HB_VERSION \"$(HB_VERSION)\"" >> $(TOP)/libhb/$(1)
    echo "#endif" >> $(TOP)/libhb/$(1)
    echo "#ifndef HB_APPCAST_URL" >> $(TOP)/libhb/$(1)
    echo "#define APPCAST_URL \"$(APPCAST_URL)\"" >> $(TOP)/libhb/$(1)
    echo "#endif" >> $(TOP)/libhb/$(1)
}
HBVersion hbversion.h ;

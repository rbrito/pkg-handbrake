Subject: Enable compilation on kFreeBSD arches.
From: Christian Marillat <marillat@debian.org>
Date: Tue, 15 May 2012 04:49:36 -0300

Reviewed-by: Rog√©rio Theodoro de Brito <rbrito@ime.usp.br>
Last-Update: 2012-05-15
Forwarded: no

--- a/libhb/ports.h
+++ b/libhb/ports.h
@@ -51,7 +51,7 @@
 #elif defined( SYS_DARWIN )
 #  define HB_LOW_PRIORITY    0
 #  define HB_NORMAL_PRIORITY 31
-#elif defined( SYS_LINUX ) || defined( SYS_FREEBSD ) || defined ( SYS_SunOS )
+#elif defined( SYS_LINUX ) || defined( SYS_FREEBSD ) || defined ( SYS_SunOS ) || defined ( __FreeBSD_kernel__ )
 #  define HB_LOW_PRIORITY    0
 #  define HB_NORMAL_PRIORITY 0
 #elif defined( SYS_CYGWIN )
--- a/gtk/configure.ac
+++ b/gtk/configure.ac
@@ -93,6 +93,9 @@
 	fi
 	mingw_flag=yes
     ;;
+    *kfreebsd*)
+    	GHB_PACKAGES="gtk+-2.0 >= 2.10 gthread-2.0 gstreamer-0.10 gstreamer-interfaces-0.10 gstreamer-video-0.10 gstreamer-pbutils-0.10 gio-2.0 libnotify dbus-glib-1 webkit-1.0"
+    ;;
   *)
     if test "x$gst_disable" = "xyes" ; then
 	    GHB_PACKAGES="gtk+-2.0 >= 2.10 gthread-2.0 gio-2.0 libnotify dbus-glib-1 gudev-1.0"
--- a/gtk/src/callbacks.c
+++ b/gtk/src/callbacks.c
@@ -28,7 +28,9 @@
 #if !defined(_WIN32)
 #include <poll.h>
 #define G_UDEV_API_IS_SUBJECT_TO_CHANGE 1
+#if !defined( __FreeBSD_kernel__ )
 #include <gudev/gudev.h>
+#endif
 #include <dbus/dbus-glib.h>
 #include <dbus/dbus-glib-lowlevel.h>
 
@@ -49,6 +51,9 @@
 #endif
 
 #include <gdk/gdkx.h>
+#ifndef NOTIFY_CHECK_VERSION
+#define NOTIFY_CHECK_VERSION(x,y,z) 0
+#endif
 #else
 #define WINVER 0x0500
 #include <winsock2.h>
@@ -3943,14 +3948,14 @@
 	return dvd_devices;
 }
 
-#if !defined(_WIN32)
+#if !defined(_WIN32) && !defined( __FreeBSD_kernel__ )
 static GUdevClient *udev_ctx = NULL;
 #endif
 
 gboolean
 ghb_is_cd(GDrive *gd)
 {
-#if !defined(_WIN32)
+#if !defined(_WIN32) && !defined( __FreeBSD_kernel__ )
 	gchar *device;
 	GUdevDevice *udd;
 
@@ -3984,7 +3989,7 @@
 void
 ghb_udev_init()
 {
-#if !defined(_WIN32)
+#if !defined(_WIN32) && !defined( __FreeBSD_kernel__ )
 	udev_ctx = g_udev_client_new(NULL);
 #endif
 }
